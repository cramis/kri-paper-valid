# KRI λ…Όλ¬Έ κ²€μ¦ μ‹μ¤ν… μ½”λ“ λ¶„μ„ λ³΄κ³ μ„

## π“‹ κ°μ”

λ³Έ λ³΄κ³ μ„λ” KRI(ν•κµ­μ—°κµ¬μ¬λ‹¨) λ…Όλ¬Έ κ²€μ¦ μ‹μ¤ν…κ³Όμ μ—°λ™μ„ μ„ν• Next.js μ• ν”λ¦¬μΌ€μ΄μ…μ μ£Όμ” μ»΄ν¬λ„νΈλ“¤μ„ λ¶„μ„ν• κ²°κ³Όμ…λ‹λ‹¤.

## π” λ¶„μ„ λ€μƒ νμΌ

1. `app/api-test/page.tsx` - ν”„λ΅ νΈμ—”λ“ ν…μ¤νΈ μΈν„°νμ΄μ¤
2. `app/api/wise-encode/route.ts` - μ—°κµ¬μ μ •λ³΄ μ•”νΈν™” API
3. `app/api/wise-sso/route.ts` - KRI SSO μ—°λ™ API
4. `app/api/paper-validation/callback/route.ts` - λ…Όλ¬Έ κ²€μ¦ μ½λ°± μ²λ¦¬
5. `app/api/paper-validation/result/route.ts` - κ²€μ¦ κ²°κ³Ό μμ‹  μ²λ¦¬

## π—οΈ μ‹μ¤ν… μ•„ν‚¤ν…μ² λ¶„μ„

### μ›ν¬ν”λ΅μ° κ°μ”
```
[ν΄λΌμ΄μ–ΈνΈ] β†’ [wise-encode] β†’ [KRI μΈμ¦] β†’ [wise-sso] β†’ [KRI κ²€μ¦] β†’ [callback/result] β†’ [ν΄λΌμ΄μ–ΈνΈ]
```

### μ£Όμ” κµ¬μ„± μ”μ†

#### 1. ν”„λ΅ νΈμ—”λ“ ν…μ¤νΈ μΈν„°νμ΄μ¤ (`api-test/page.tsx`)
- **λ©μ **: KRI λ…Όλ¬Έ κ²€μ¦ μ›ν¬ν”λ΅μ° ν…μ¤νΈ
- **μ£Όμ” κΈ°λ¥**: 
  - WISE μΈμ½”λ”© μ”μ²­ μ²λ¦¬
  - νμ—… μ°½μ„ ν†µν• KRI μ‹μ¤ν… μ—°λ™
  - postMessage APIλ¥Ό ν†µν• κ²°κ³Ό μμ‹ 

#### 2. μ—°κµ¬μ μ •λ³΄ μ•”νΈν™” API (`wise-encode/route.ts`)
- **λ©μ **: KRI μ‹μ¤ν…μΌλ΅λ¶€ν„° μ•”νΈν™”λ μ—°κµ¬μ λ“±λ΅λ²νΈ νλ“
- **μ™Έλ¶€ μ—°λ™**: `https://www.kri.go.kr/kri/ra/cm/sso/wise_Encode.jsp`
- **λ°μ΄ν„° μ²λ¦¬**: HTML μ‘λ‹µμ—μ„ μ •κ·ν‘ν„μ‹μΌλ΅ `okri_param1` μ¶”μ¶

#### 3. KRI SSO μ—°λ™ API (`wise-sso/route.ts`)
- **λ©μ **: KRI λ…Όλ¬Έ κ²€μ¦ μ‹μ¤ν…μΌλ΅ μ”μ²­ μ „λ‹¬
- **μ™Έλ¶€ μ—°λ™**: `http://www.kri.go.kr/kri/ra/cm/sso/wisesso_pop_api_utf8.jsp`
- **λ°μ΄ν„° ν•μ‹**: application/x-www-form-urlencoded

#### 4. λ…Όλ¬Έ κ²€μ¦ μ½λ°± μ²λ¦¬ (`paper-validation/callback/route.ts`)
- **λ©μ **: KRI μ‹μ¤ν…μ—μ„ μ „λ‹¬λ°›μ€ κ²€μ¦ κ²°κ³Ό μ²λ¦¬
- **μ§€μ› λ°©μ‹**: POST/GET μ”μ²­ λ¨λ‘ μ§€μ›
- **λ°μ΄ν„° λ§¤ν•‘**: 17κ° KRI νλΌλ―Έν„°λ¥Ό κµ¬μ΅°ν™”λ κ°μ²΄λ΅ λ³€ν™

#### 5. κ²€μ¦ κ²°κ³Ό μμ‹  μ²λ¦¬ (`paper-validation/result/route.ts`)
- **λ©μ **: KRI μ‹μ¤ν…μΌλ΅λ¶€ν„° μµμΆ… κ²€μ¦ κ²°κ³Ό μμ‹ 
- **λ³΄μ• μ²λ¦¬**: XSS λ°©μ§€λ¥Ό μ„ν• `<` νƒκ·Έ μ΄μ¤μΌ€μ΄ν•‘
- **ν†µμ‹  λ°©μ‹**: postMessage APIλ¥Ό ν†µν• λ¶€λ¨ μ°½κ³Όμ ν†µμ‹ 

## π”’ λ³΄μ• λ¶„μ„

### β… λ³΄μ• κ°•μ 
1. **XSS λ°©μ§€**: `result/route.ts`μ—μ„ `<` νƒκ·Έ μ΄μ¤μΌ€μ΄ν•‘ μ²λ¦¬
2. **Origin κ²€μ¦**: `api-test/page.tsx`μ—μ„ λ©”μ‹μ§€ origin κ²€μ¦ (`localhost:3000`)
3. **μ—λ¬ μ²λ¦¬**: λ¨λ“  APIμ—μ„ try-catchλ¥Ό ν†µν• μ•μ „ν• μ—λ¬ μ²λ¦¬

### β οΈ λ³΄μ• μ·¨μ•½μ 

#### λ†’μ€ μ„ν—λ„
1. **ν•λ“μ½”λ”©λ λ―Όκ° μ •λ³΄**:
   - κΈ°κ΄€ λΉ„λ°€λ²νΈ (`donga131440`) ν•λ“μ½”λ”©
   - κΈ°κ΄€ ID (`131440`) ν•λ“μ½”λ”©
   - μ—°κµ¬μ λ“±λ΅λ²νΈ (`10054944`) ν•λ“μ½”λ”©

2. **postMessage λ³΄μ• μ·¨μ•½μ **:
   - `result/route.ts`μ—μ„ `postMessage(*, '*')` μ‚¬μ© (λ¨λ“  origin ν—μ©)
   - μ•μ „ν• λ€μ•: νΉμ • origin μ§€μ • ν•„μ”

#### μ¤‘κ°„ μ„ν—λ„
3. **HTTP ν†µμ‹ **: KRI SSO APIκ°€ HTTP ν”„λ΅ν† μ½ μ‚¬μ© (HTTPS μ•„λ‹)
4. **μ…λ ¥ κ²€μ¦ λ¶€μ΅±**: API μ”μ²­ νλΌλ―Έν„°μ— λ€ν• μ ν¨μ„± κ²€μ¦ μ—†μ

## β΅ μ„±λ¥ λ¶„μ„

### μ„±λ¥ νΉμ„±
- **μ™Έλ¶€ API μμ΅΄μ„±**: KRI μ‹μ¤ν… μ‘λ‹µ μ‹κ°„μ— μΆ…μ†
- **λ™κΈ° μ²λ¦¬**: μμ°¨μ  API νΈμ¶λ΅ μ „μ²΄ μ‘λ‹µ μ‹κ°„ μ¦κ°€
- **λ©”λ¨λ¦¬ μ‚¬μ©**: νμ—… μ°½κ³Ό HTML λ¬Έμ„ μƒμ„±μΌλ΅ ν΄λΌμ΄μ–ΈνΈ λ©”λ¨λ¦¬ μ‚¬μ©

### κ°μ„  λ°©μ•
1. **νƒ€μ„μ•„μ›ƒ μ„¤μ •**: μ™Έλ¶€ API νΈμ¶ μ‹ νƒ€μ„μ•„μ›ƒ μ„¤μ •
2. **μ—λ¬ μ¬μ‹λ„**: λ„¤νΈμ›ν¬ μ¤λ¥ μ‹ μ¬μ‹λ„ λ΅μ§
3. **λ΅λ”© μƒνƒ**: μ‚¬μ©μ κ²½ν— κ°μ„ μ„ μ„ν• λ΅λ”© μΈλ””μΌ€μ΄ν„°

## π›οΈ μ•„ν‚¤ν…μ² λ¶„μ„

### μ•„ν‚¤ν…μ² κ°•μ 
1. **λ¨λ“ν™”**: κ° κΈ°λ¥λ³„λ΅ λ…ν™•ν λ¶„λ¦¬λ API μ—”λ“ν¬μΈνΈ
2. **RESTful μ„¤κ³„**: HTTP λ©”μ„λ“μ™€ URI κµ¬μ΅°κ°€ λ…ν™•
3. **Next.js App Router**: μµμ‹  Next.js ν¨ν„΄ ν™μ©

### μ•„ν‚¤ν…μ² κ°μ„ μ 
1. **μ„¤μ • κ΄€λ¦¬**: ν™κ²½λ³€μλ¥Ό ν†µν• μ„¤μ • λ¶„λ¦¬ ν•„μ”
2. **μ—λ¬ μ²λ¦¬ ν‘μ¤€ν™”**: μΌκ΄€λ μ—λ¬ μ‘λ‹µ ν•μ‹ ν•„μ”
3. **λ΅κΉ…**: μ΄μ ν™κ²½μ—μ„μ λ¨λ‹ν„°λ§μ„ μ„ν• λ΅κΉ… μ‹μ¤ν…

## π“ μ½”λ“ ν’μ§ λ¶„μ„

### ν’μ§ μ§€ν‘
- **TypeScript μ‚¬μ©**: β… νƒ€μ… μ•μ „μ„± ν™•λ³΄
- **μ—λ¬ μ²λ¦¬**: β… λ¨λ“  APIμ—μ„ try-catch κµ¬ν„
- **μ½”λ“ κµ¬μ΅°**: β… λ…ν™•ν• ν•¨μ λ¶„λ¦¬
- **μ£Όμ„**: β οΈ ν•κΈ€ μ£Όμ„μΌλ΅ κ°€λ…μ„± μ–‘νΈν•λ‚ μλ¬Έ μ¶”κ°€ κ¶μ¥

### κ°μ„  κ¶μ¥μ‚¬ν•­
1. **ν™κ²½λ³€μ μ‚¬μ©**: ν•λ“μ½”λ”©λ κ°’λ“¤μ„ ν™κ²½λ³€μλ΅ μ΄λ™
2. **νƒ€μ… μ •μ**: API μ‘λ‹µμ— λ€ν• TypeScript μΈν„°νμ΄μ¤ μ •μ
3. **μ ν‹Έλ¦¬ν‹° ν•¨μ**: κ³µν†µ λ΅μ§μ ν•¨μν™”
4. **ν…μ¤νΈ μ½”λ“**: λ‹¨μ„ ν…μ¤νΈ λ° ν†µν•© ν…μ¤νΈ μ¶”κ°€

## π¨ μ°μ„ μμ„λ³„ κ°μ„  κ³Όμ 

### π”΄ μ¦‰μ‹ ν•΄κ²° ν•„μ” (Critical)
1. **λ―Όκ° μ •λ³΄ λ³΄μ•**: ν•λ“μ½”λ”©λ κΈ°κ΄€ λΉ„λ°€λ²νΈ λ° IDλ¥Ό ν™κ²½λ³€μλ΅ μ΄λ™
2. **postMessage λ³΄μ•**: origin κ²€μ¦ κ°•ν™”

### π΅ λ‹¨κΈ° κ°μ„  (High)
3. **HTTPS ν†µμ‹ **: KRI API μ—°λ™ μ‹ HTTPS μ‚¬μ© κ²€ν† 
4. **μ…λ ¥ κ²€μ¦**: API νλΌλ―Έν„° μ ν¨μ„± κ²€μ¦ λ΅μ§ μ¶”κ°€
5. **μ—λ¬ μ²λ¦¬ ν‘μ¤€ν™”**: μΌκ΄€λ μ—λ¬ μ‘λ‹µ ν•μ‹ μ •μ

### πΆ μ¤‘μ¥κΈ° κ°μ„  (Medium)
6. **μ„±λ¥ μµμ ν™”**: νƒ€μ„μ•„μ›ƒ μ„¤μ • λ° μ¬μ‹λ„ λ΅μ§
7. **λ¨λ‹ν„°λ§**: λ΅κΉ… λ° μ—λ¬ μ¶”μ  μ‹μ¤ν…
8. **ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€**: μλ™ν™”λ ν…μ¤νΈ ν™κ²½ κµ¬μ¶•

## π’΅ κ²°λ΅ 

KRI λ…Όλ¬Έ κ²€μ¦ μ‹μ¤ν…μ€ κΈ°λ³Έμ μΈ κΈ°λ¥ κµ¬ν„μ€ μ™„λ£λμ—μΌλ‚, λ³΄μ•κ³Ό μ΄μ μ•μ •μ„± μΈ΅λ©΄μ—μ„ κ°μ„ μ΄ ν•„μ”ν•©λ‹λ‹¤. νΉν λ―Όκ° μ •λ³΄ λ³΄μ•κ³Ό postMessage λ³΄μ• μ·¨μ•½μ μ€ μ΄μ μ „ λ°λ“μ‹ ν•΄κ²°ν•΄μ•Ό ν•  ν•µμ‹¬ κ³Όμ μ…λ‹λ‹¤.

μ „λ°μ μΌλ΅ Next.jsμ μµμ‹  ν¨ν„΄μ„ μ ν™μ©ν•κ³  μμΌλ©°, λ¨λ“ν™”λ κµ¬μ΅°λ΅ μ μ§€λ³΄μμ„±μ΄ μ–‘νΈν•©λ‹λ‹¤. λ³΄μ• μ΄μ ν•΄κ²°κ³Ό ν•¨κ» μ μ ν• ν…μ¤νΈ ν™κ²½μ„ κµ¬μ¶•ν•λ‹¤λ©΄ μ•μ •μ μΈ μ΄μμ΄ κ°€λ¥ν•  κ²ƒμΌλ΅ νλ‹¨λ©λ‹λ‹¤.